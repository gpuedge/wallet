<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üëõ</text></svg>">

    <meta name="description" content="GPUx - Wallet" />
    <meta charset="utf-8">
    <title>Wallet</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
     
    <script src="https://unpkg.com/htm@2.2.1/dist/htm.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/react@17.0.1/umd/react.production.min.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/react-dom@17.0.1/umd/react-dom.production.min.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/deepmerge@4.2.2/dist/umd.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tweetnacl/1.0.3/nacl-fast.min.js" crossorigin="anonymous"></script>

    <!-- Google font file. If you want you can change. -->
    <link href="https://fonts.googleapis.com/css?family=Nunito:300,400,600,700,900" rel="stylesheet">

    <!-- Fontawesome font file css -->
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">

    <!-- Animate css file for css3 animations. for more : https://daneden.github.io/animate.css -->
    <!-- Only use animate action. If you dont use animation, you don't have to add.-->
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <!-- <link rel="stylesheet" type="text/css" href="css/cryptocoins.css"> -->
    
    <!-- <link rel="stylesheet" type="text/css" href="plugins/c3-chart/c3.css"> -->

    <!-- Swiper slider css file -->
    <link rel="stylesheet" href="https://rawcdn.githack.com/gpuedge/wallet/a6a590d3276152d1b66ec2bff4a256144210c7ee/src/html/css/swiper.min.css">
    <!-- <link rel="stylesheet" href="css/jqcandlestick.css"> -->

    <!--turbo slider plugin css file -->
    <link rel="stylesheet" type="text/css" href="https://rawcdn.githack.com/gpuedge/wallet/a6a590d3276152d1b66ec2bff4a256144210c7ee/src/html/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://rawcdn.githack.com/gpuedge/wallet/a6a590d3276152d1b66ec2bff4a256144210c7ee/src/html/plugins/turbo-slider/turbo.css">

    <!-- Template global css file. Requared all pages -->
    <link rel="stylesheet" type="text/css" href="https://rawcdn.githack.com/gpuedge/wallet/a6a590d3276152d1b66ec2bff4a256144210c7ee/src/html/css/global.style.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://rawcdn.githack.com/gpuedge/wallet/a6a590d3276152d1b66ec2bff4a256144210c7ee/src/html/plugins/turbo-slider/turbo.min.js"></script>
    <script src="https://rawcdn.githack.com/gpuedge/wallet/a6a590d3276152d1b66ec2bff4a256144210c7ee/src/html/js/global.script.js"></script>

    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://unpkg.com/@stripe/react-stripe-js@latest/dist/react-stripe.umd.js"></script>

    <style>
      .stripe-button {
        background: #5469d4;
        font-family: Arial, sans-serif;
        color: #ffffff;
        border-radius: 4px;
        border: 0;
        padding: 12px 16px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        display: block;
        transition: all 0.2s ease;
        box-shadow: 0px 4px 5.5px 0px rgba(0, 0, 0, 0.07);
        width: 100%;
        margin-top: 24px;
      }

      .stripe-button:hover {
        filter: contrast(115%);
      }

      .stripe-button:disabled {
        opacity: 0.5;
        cursor: default;
      }

      #payment-message {
        color: rgb(105, 115, 134);
        font-size: 16px;
        line-height: 20px;
        padding-top: 12px;
        text-align: center;
      }

      /* spinner/processing state, errors */
      .stripe-spinner,
      .stripe-spinner:before,
      .stripe-spinner:after {
        border-radius: 50%;
      }

      .stripe-spinner {
        color: #ffffff;
        font-size: 22px;
        text-indent: -99999px;
        margin: 0px auto;
        position: relative;
        width: 20px;
        height: 20px;
        box-shadow: inset 0 0 0 2px;
        -webkit-transform: translateZ(0);
        -ms-transform: translateZ(0);
        transform: translateZ(0);
      }

      .stripe-spinner:before,
      .stripe-spinner:after {
        position: absolute;
        content: '';
      }

      .stripe-spinner:before {
        width: 10.4px;
        height: 20.4px;
        background: #5469d4;
        border-radius: 20.4px 0 0 20.4px;
        top: -0.2px;
        left: -0.2px;
        -webkit-transform-origin: 10.4px 10.2px;
        transform-origin: 10.4px 10.2px;
        -webkit-animation: loading 2s infinite ease 1.5s;
        animation: loading 2s infinite ease 1.5s;
      }

      .stripe-spinner:after {
        width: 10.4px;
        height: 10.2px;
        background: #5469d4;
        border-radius: 0 10.2px 10.2px 0;
        top: -0.1px;
        left: 10.2px;
        -webkit-transform-origin: 0px 10.2px;
        transform-origin: 0px 10.2px;
        -webkit-animation: loading 2s infinite ease;
        animation: loading 2s infinite ease;
      }

      @keyframes loading {
        0% {
          -webkit-transform: rotate(0deg);
          transform: rotate(0deg);
        }
        100% {
          -webkit-transform: rotate(360deg);
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>

    <div id="app"></div>

    <script type="module">
      export var initialState = {
        path: globalThis.location.pathname == "" ? "/" : globalThis.location.pathname,
        remote: {
          credit: 0.00,
          earned: 0.00,
        },
        menu: {
          modal_private_key_open: false,
        },
        dashboard: {
          model_buy_credits_open: false,
          buy_credits_step: 0,
          buy_credits_amount: "610",
        },
        wizard_new_user: {
          open: true,
          slider_state: [0],
          email: "",
          password: "",
          secret_key: "",
        },
      };

      function isMergeableObject(value) {
        return isNonNullObject(value) &&
          !isSpecial(value)
      }

      function isNonNullObject(value) {
        return !!value && typeof value === 'object'
      }

      function isSpecial(value) {
        var stringValue = Object.prototype.toString.call(value)

        return stringValue === '[object RegExp]' ||
          stringValue === '[object Date]' ||
          stringValue === '[object Uint8Array]' ||
          isReactElement(value)
      }

      var canUseSymbol = typeof Symbol === 'function' && Symbol.for
      var REACT_ELEMENT_TYPE = canUseSymbol ? Symbol.for('react.element') : 0xeac7

      function isReactElement(value) {
        return value.$$typeof === REACT_ELEMENT_TYPE
      }

      export let globalState = {};
      export let setGlobalState0 = () => {};
      export let setGlobalState = (new_state) => {
        var state = globalThis.deepmerge(globalState, new_state, {
          arrayMerge: (dest, source, opts) => source,
          isMergeableObject: (obj) => isMergeableObject(obj)
        })
        setGlobalState0(state);
      };
      export let setGlobalStateFull = (new_state) => {
        setGlobalState0(new_state);
      };

      export let mergeObjects = (old_state, new_state) => {
        var state = globalThis.deepmerge(old_state, new_state, {
          arrayMerge: (dest, source, opts) => source,
          isMergeableObject: (obj) => isMergeableObject(obj)
        })
        return state;
      };

      export function wireUpGlobalState(hook_globalState, hook_setGlobalState0) {
        globalState = hook_globalState;
        setGlobalState0 = hook_setGlobalState0;
      }

      export function buildInitialState() {
        return {
          ...initialState,
        };
      };

      export function getInitialState() {
        return initialState;
      };

      export function setInitialState(state) {
        initialState = mergeObjects(initialState, state)
        return initialState;
      };

      export const doNav = async (e, next_page) => {
        if (e) {
          e.preventDefault();
        }
        if (globalState.path !== next_page) {
          globalThis.history.pushState(undefined, undefined, `${next_page}`);
          setGlobalState({
            path: next_page
          });
        }
        return false;
      }

      globalThis.onpopstate = function(e) {
        var next_page = globalThis.location.pathname;
        setGlobalState({
          path: next_page
        });
      }

      const { createElement, useState, useEffect, useRef } = React;
      const html = htm.bind(createElement);

      const { loadStripe } = Stripe;
      const { Elements } = ReactStripe;
      const { CardElement, PaymentElement, useStripe, useElements } = ReactStripe;

      const stripe_promise = Stripe("pk_test_LvYeio4zWnczfO3g1IMlpBbf");

      const BNDLR_HACK = `${globalThis.location.protocol}//rawcdn.githack.com/gpuedge/wallet/a6a590d3276152d1b66ec2bff4a256144210c7ee/src/html/`

      function fn_logout(e) {
        e.preventDefault();
        localStorage.removeItem("privkey:0");
        window.location = "/"
        return false;
      }

      function MenuSide() {
        return html`
        <div class="nav-menu">
          <nav class="menu">
            <div class="nav-container">

              <div class="popup-overlay" id="basicPopup" style=${{display: globalState.menu.modal_private_key_open ? "block" : "none", zIndex: 1111}}>
                <div class="popup-container">
                  <div class="popup-content">
                    ${globalState.sec_b58}
                  </div>
                </div>
              </div>

              <ul class="main-menu">
                <li class="active">
                  <a href="/"><img src="${BNDLR_HACK}img/content/icons/1.png" alt="" /><strong class="special">Dashboard</strong></a>
                </li>
                <li class="">
                  <a href="/show_private_key" onClick=${e=> {e.preventDefault(); setGlobalState({menu: {modal_private_key_open: true}}); return false;}}><img src="${BNDLR_HACK}img/content/icons/11.png" alt="" /><strong class="special">Private Key</strong> </a>
                </li>
                <li>
                  <a href="/logout" onClick=${e=> fn_logout(e)}><img src="${BNDLR_HACK}img/content/icons/9.png" alt="" /><strong class="special">Logout</strong> </a>
                </li>
                <!--<li class="">
                  <a href="wallet.html"><img src="${BNDLR_HACK}img/content/icons/2.png" alt="" /><strong class="special">My Walet</strong> </a>
                </li>
                <li class="">
                  <a href="trading.html"><img src="${BNDLR_HACK}img/content/icons/3.png" alt="" /><strong class="special">Crypto Trade</strong> </a>
                </li>
                <li class="">
                  <a href="buy-sell.html"><img src="${BNDLR_HACK}img/content/icons/6.png" alt="" /><strong class="special">Buy & sell</strong> </a>
                </li>
                <li class="">
                  <a href="profile.html"><img src="${BNDLR_HACK}img/content/icons/5.png" alt="" /><strong class="special">Trader Profile</strong> </a>
                </li>
                <li class="">
                  <a href="affiliate.html"><img src="${BNDLR_HACK}img/content/icons/4.png" alt="" /><strong class="special">Affiliate System</strong> </a>
                </li>
                <li class="">
                  <a href="setting.html"><img src="${BNDLR_HACK}img/content/icons/11.png" alt="" /><strong class="special">Settings</strong> </a>
                </li>
                <li>
                  <a href="javascript:void(0);"><img src="${BNDLR_HACK}img/content/icons/9.png" alt="" /><strong class="special">Login/Register</strong> <span class="fa fa-angle-down"></span></a>
                  <ul>
                    <li><a href="login.html" data-loader="show">Login</a></li>
                    <li><a href="signup.html" data-loader="show">Register</a></li>
                    <li><a href="forgot-password.html" data-loader="show">Forgot Password</a></li>
                  </ul>
                </li>
                <li>
                  <a href="javascript:void(0);"><img src="${BNDLR_HACK}img/content/icons/8.png" alt="" /> <strong class="special">Wizards</strong> <span class="fa fa-angle-down"></span></a>
                  <ul>
                    <li><a href="wizard-default.html" data-loader="show">Wizard Default</a></li>
                    <li><a href="wizard-fullscreen.html" data-loader="show">Wizard Fullscreen</a></li>
                  </ul>
                </li>
                <li class="">
                  <a href="charts.html"><img src="${BNDLR_HACK}img/content/icons/14.png" alt="" /><strong class="special">Charts</strong> </a>
                </li>
                <li>
                  <a href="forms.html" data-loader="show"><img src="${BNDLR_HACK}img/content/icons/7.png" alt="" /><strong class="special">Form Elements</strong></a>
                </li>
                <li>
                  <a href="#"><img src="${BNDLR_HACK}img/content/icons/10.png" alt="" /><strong class="special"> Components</strong> <span class="fa fa-angle-down"></span></a>
                  <ul>
                    <li><a href="tab-bottom.html" data-loader="show">Tab (Bottom)</a></li>
                    <li><a href="tab-top.html" data-loader="show">Tab (Top)</a></li>
                    <li><a href="accordion.html" data-loader="show">Accordion</a></li>
                    <li><a href="popup.html" data-loader="show">Popup Modal</a></li>
                    <li><a href="checkbox-list.html" data-loader="show">Check List</a></li>
                    <li><a href="link-list.html" data-loader="show">Link List</a></li>
                    <li><a href="link-list-two-column.html" data-loader="show">Two Column Links</a></li>
                  </ul>
                </li>
                <li class="">
                  <a href="#"><img src="${BNDLR_HACK}img/content/icons/15.png" alt="" /><strong class="special"> Pages</strong> <span class="fa fa-angle-down"></span></a>
                  <ul>
                    <li class=""><a href="profile.html" data-loader="show">User Profile</a></li>
                    <li><a href="search-result.html" data-loader="show">Search Results</a></li>
                    <li><a href="contact.html" data-loader="show">Contact</a></li>
                    <li><a href="blank.html" data-loader="show">Blank Page</a></li>
                  </ul>
                </li>-->
              </ul>
            </div>
          </nav>
        </div>
        `
      }

      function WalletDashboard() {
        return html`
        <div class="wrapper-inline">
          <header class="no-background">
            <div class="search-button" data-search="open">
              GPUX
            </div>
            <div class="navi-menu-button">
              <em></em>
              <em></em>
              <em></em>
            </div>
          </header>
          <main class="margin mt-0">
            <div class="dash-balance">
              <div class="d-flex align-items-center mt-30">
                <div class="d-flex flex-grow">
                  <div class="mr-auto">
                    <h1 class="b-val"> 2589.50 </h1>
                    <p class="g-text mb-0">Total Credits</p>
                  </div>
                  <div class="ml-auto align-self-end">
                    <a href="profile.html" class="profile-av"><img src="${BNDLR_HACK}img/content/avatar/avatar.png" /></a>
                  </div>
                </div>
              </div>
              <div class="services-bulk">
                <div class="content-row">
                  <div class="serv-item">
                    <a href="" class="serv-icon"><img src="${BNDLR_HACK}img/content/icon1.png" class="mb-5" alt="" /></a>
                    <span>Send </span>
                  </div>
                  <div class="serv-item">
                    <a href="" class="serv-icon"><img src="${BNDLR_HACK}img/content/icon2.png" class="mb-5" alt="" /></a>
                    <span>Recieve </span>
                  </div>
                  <div class="serv-item">
                    <a href="" class="serv-icon"><img src="${BNDLR_HACK}img/content/icon4.png" class="mb-5" alt="" /></a>
                    <span>Loan </span>
                  </div>
                  <div class="serv-item">
                    <a href="" class="serv-icon"><img src="${BNDLR_HACK}img/content/icon3.png" class="mb-5" alt="" /></a>
                    <span>Topup </span>
                  </div>
                </div>
              </div>
            </div>
            <footer>
              <div class="container">
                <ul>
                  <li><a href="#"><i class="fa fa-facebook"></i></a></li>
                  <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                  <li><a href="#"><i class="fa fa-google"></i></a></li>
                  <li><a href="#"><i class="fa fa-instagram"></i></a></li>
                </ul>
                <p>Copyright ¬© All Right Reserved</p>
              </div>
            </footer>
          </main>
        </div>
        `
      }

      function CheckoutForm({amount}) {
        const [clientSecret, setClientSecret] = useState("");

        useEffect(async () => {
          // Create PaymentIntent as soon as the page loads
          var reply = await fetch("/api/stripe/create-payment-intent", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({public_key: globalState.pub_b58, amount: amount}),
          })
          var {client_secret} = await reply.json()
          setClientSecret(client_secret);
        }, []);

        const appearance = {
          theme: 'stripe',
        };
        const options = {
          clientSecret,
          appearance,
        };

        return html`
        <section class="crypto container">
          ${clientSecret &&
          html`<${Elements} options=${options} stripe=${stripe_promise}>
            <${CheckoutForm2} amount=${amount} />
          <//>`
          }
        </section>
        `
      }

      function CheckoutForm2({amount}) {
        const stripe = useStripe();
        const elements = useElements();

        const [message, setMessage] = useState(null);
        const [isLoading, setIsLoading] = useState(false);

        useEffect(() => {
          if (!stripe) {
            return;
          }

          const clientSecret = new URLSearchParams(window.location.search).get(
            "payment_intent_client_secret"
          );

          if (!clientSecret) {
            return;
          }

          stripe.retrievePaymentIntent(clientSecret).then(({ paymentIntent }) => {
            switch (paymentIntent.status) {
              case "succeeded":
                setMessage("Payment succeeded!");
                break;
              case "processing":
                setMessage("Your payment is processing.");
                break;
              case "requires_payment_method":
                setMessage("Your payment was not successful, please try again.");
                break;
              default:
                setMessage("Something went wrong.");
                break;
            }
          });
        }, [stripe]);

        const handleSubmit = async (e) => {
          e.preventDefault();

          if (!stripe || !elements) {
            // Stripe.js has not yet loaded.
            // Make sure to disable form submission until Stripe.js has loaded.
            return false;
          }

          setIsLoading(true);

          const { error } = await stripe.confirmPayment({
            elements,
            confirmParams: {
              // Make sure to change this to your payment completion page
              return_url: "https://wallet.gpux.ai/",
            },
          });

          // This point will only be reached if there is an immediate error when
          // confirming the payment. Otherwise, your customer will be redirected to
          // your `return_url`. For some payment methods like iDEAL, your customer will
          // be redirected to an intermediate site first to authorize the payment, then
          // redirected to the `return_url`.
          if (error.type === "card_error" || error.type === "validation_error") {
            setMessage(error.message);
          } else {
            setMessage("An unexpected error occured.");
          }

          setIsLoading(false);
          return false;
        };

        return html`
          <form id="payment-form">
            <${PaymentElement} id="payment-element" />
            <button type="button" disabled=${isLoading || !stripe || !elements} id="submit" class="stripe-button" onClick=${handleSubmit}>
              <span id="button-text">
                ${isLoading ? html`<div className="stripe-spinner" id="spinner"></div>` : `Pay $${(amount/100).toFixed(2)} now`}
              </span>
            </button>
            ${message && html`<div id="payment-message">${message}</div>`}
          </form>
        `
      }

      function WalletDashboard2() {
        var bc_modal_open = globalState.dashboard.model_buy_credits_open;

        var fn_buy_credits = function(e) {
          e.preventDefault();
          //if (!globalState.remote.card) {
          //  alert("Add a credit card first!")
          //  return false
          //}
          //setGlobalState({dashboard: {model_buy_credits_open: true}});
          setGlobalState({dashboard: {buy_credits_step: 1}});
          return false;
        }

        var fn_buy_credits_2 = function(e, amount) {
          e.preventDefault();
          setGlobalState({dashboard: {buy_credits_step: 2, buy_amount: amount}});
          return false;
        }

        return html`
        <div class="wrapper-inline">
          <header>
            <h1 class="page-title">Dashboard</h1>
            <div class="search-button" data-search="open">
              GPUX
            </div>
            <div class="navi-menu-button">
              <em></em>
              <em></em>
              <em></em>
            </div>
          </header>
          <main>

            <div class="container">
              
              <div class="form-divider"></div>

              <form id="settingsForm">
                <div class="list-box">
                  <div class="list-item">
                    <img src="https://assets.coingecko.com/coins/images/17233/large/imx.png?1636691817" alt="" />
                    <em class="seperate"></em>
                    <span class="list-item-title">Credit <small class="text-muted"> - ${globalState.remote.credit} </small></span>

                    ${globalState.dashboard.buy_credits_step == 0 &&
                      html`
                      <div style=${{float: "right"}}>
                        <a href="/buy_credits" class="more-btn" style=${{marginTop: "0px", padding: "6px 30px", borderRadius: "0px"}} 
                          onClick=${e=> fn_buy_credits(e)}>Buy Credits</a>
                      </div>`
                    }
                  </div>
                </div>

                <div class="list-box">
                  <div class="list-item">
                    <img src="https://s2.coinmarketcap.com/static/img/coins/200x200/4943.png" alt="" />
                    <em class="seperate"></em>
                    <span class="list-item-title">Earned <small class="text-muted"> - ${globalState.remote.earned} </small></span>

                    <!--<div style=${{float: "right"}}>
                      <a href="/login_with_email" class="more-btn" style=${{marginTop: "0px"}} onClick=${e=> fn_login_with_email(e)}>Withdraw</a>
                    </div>-->
                  </div>
                </div>

                ${
                  globalState.dashboard.buy_credits_step == 1
                  ? [
                    html`<div class="form-divider"></div>`,
                    html`<div class="form-label-divider"><span>Select Amount</span></div>`
                  ]
                  : globalState.dashboard.buy_credits_step == 2
                    ? [
                      html`<div class="form-divider"></div>`,
                      html`<div class="form-label-divider"><span>Create Payment</span></div>`
                    ]
                    : null
                }

                <!-- <section class="crypto container">
                  <h4 class="title-main">Card Settings</h4>
                  <div class="swiper-container">
                    <div class="swiper-wrapper">
                      <div class="swiper-slide">
                        <div class="card-content card2">
                          <i class="fa fa-check check-green"></i>
                          <h3 class="card-no mb-10"><span>****</span><span>****</span><span>****</span><span>2864</span></h3>
                          <div class="card-info d-flex">
                            <div class="holder-info">
                              <small class="c-info">Card Holder</small>
                              <h6 class="c-name">Smith Wright</h6>
                            </div>
                              <div class="expire-info">
                              <small class="c-info">Expires</small>
                              <h6 class="c-name">08/22</h6>
                            </div>
                            <div class="cvv-info">
                              <small class="c-info">CVV</small>
                              <h6 class="c-name">826</h6>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </section> -->
                
                ${
                  globalState.dashboard.buy_credits_step == 2
                  ? [
                    html`<div class="form-divider"></div>`,
                    html`<${CheckoutForm} amount=${globalState.dashboard.buy_amount} />`
                  ] : null
                }

                <div class="form-divider"></div>
                ${globalState.dashboard.buy_credits_step == 1
                  ? [
                    html`<a href="#" class="button circle block" id="getCheckedButton" style=${{marginBottom: "12px"}} onClick=${e=> fn_buy_credits_2(e, "610")}>Buy 5 Credits - $6.10</a>`,
                    html`<a href="#" class="button circle block" id="getCheckedButton" style=${{marginBottom: "12px"}} onClick=${e=> fn_buy_credits_2(e, "2440")}>Buy 20 Credits - $24.40</a>`,
                    html`<a href="#" class="button circle block yellow" id="getCheckedButton" onClick=${e=> fn_buy_credits_2(e, "12200")}>Buy 100 Credits - $122.00</a>`,
                  ]
                  : null
                }
                <!-- <div class="form-row mb-70">
                  ${!globalState.remote.card
                    ? html`<a href="#" class="button circle block green" id="getCheckedButton">Add Credit Card</a>`
                    : html`<a href="#" class="button circle block red" id="getCheckedButton">Remove Credit Card</a>`
                  }
                </div> 
                <div class="form-divider"></div> -->


                <div class="popup-overlay" id="formPopup" style=${{display: bc_modal_open ? "block" : "none", zIndex: 1111}}> <!-- if you dont want overlay add class .no-overlay -->
                  <div class="popup-container">
                    <div class="popup-header">
                      <h3 class="popup-title">Form Popup</h3>
                      <span class="popup-close" data-dismiss="true" onClick=${e=> {e.preventDefault(); setGlobalState({dashboard: {model_buy_credits_open: false}}); return false;}}><i class="fa fa-times"></i></span>
                    </div>
                    <div class="popup-content">
                      
                      <!--<div class="form-row-group with-icons">
                        <div class="form-row no-padding">
                          <i class="fa fa-envelope"></i>
                          <input type="text" class="form-element" placeholder="Input element" />
                        </div>
                      </div>-->

                      <div class="form-mini-divider"></div>

                      <div class="form-row-group with-icons">
                        <div class="form-row no-padding">
                          <i class="fa fa-money-bill"></i>
                          <select class="form-element" style=${{marginLeft: "8px"}}>
                            <option value="6.1" selected>$6.1 - 5 Credits</option>
                            <option value="24.4">$24.4 - 20 Credits</option>
                            <option value="122">$122 - 100 Credits</option>
                          </select>
                        </div>
                      </div>

                    </div>
                    <div class="popup-footer">
                      <button class="button orange">Buy</button>
                    </div>
                  </div>
                </div>


              </form>

            </div>
          </main>
        </div>
        `
      }

      // postMessage(JSON.stringify({opcode: "HACK_move_wizard_slider", index: 1}))
      function WizardNewUser() {
        const fn_move_slider = function(e, index, extra_state) {
          e.preventDefault();
          //TODO: fix this
          if (!extra_state)
            extra_state = {}
          const slider_state = [...globalState.wizard_new_user.slider_state, index]
          setGlobalState({...extra_state, wizard_new_user: {slider_state: slider_state}})
          postMessage(JSON.stringify({opcode: "HACK_move_wizard_slider", index: index}));
          return false;
        }

        const fn_move_back = function(e) {
          e.preventDefault();
          var slider_state = [...globalState.wizard_new_user.slider_state];
          slider_state.pop()
          setGlobalState({wizard_new_user: {slider_state: slider_state}})
          postMessage(JSON.stringify({opcode: "HACK_move_wizard_slider", index: slider_state[slider_state.length-1]}));
          return false;
        }

        const fn_slider_to_wallet = function(e) {
          e.preventDefault();
          setGlobalState({
            pub_b58: globalState.temp_pub_b58, sec_b58: globalState.temp_sec_b58,
            temp_pub_b58: null, temp_sec_b58: null
          });
          window.location = "/"
          return false;
        }

        const fn_login_with_email = async function(e) {
          e.preventDefault();

          var response = await fetch(`/api/email/login`, {
            method: 'POST',
            body: JSON.stringify({email: globalState.wizard_new_user.email, 
              password: globalState.wizard_new_user.password}),
            headers: {
              'Content-Type': "application/json",
              'Accept': 'application/json',
            }
          })
          var {error, ed25519_secret_key} = await response.json();
          if (error != "ok") {
            alert(`Error ${error}`)
            return false;
          } else {
            localStorage.setItem("privkey:0", ed25519_secret_key);
            window.location = "/"
          }
        }

        const fn_generate_pkey = function(e) {
          e.preventDefault();
          var [pub_b58, sec_b58] = init_seckey();
          fn_move_slider(e, 5, {temp_pub_b58: pub_b58, temp_sec_b58: sec_b58})
          return false;
        }

        const fn_login_with_seckey = function(e) {
          e.preventDefault();
          try {
            var [pb58, sec_b58] = secretkey_to_keypair(globalState.wizard_new_user.secret_key)
            localStorage.setItem("privkey:0", sec_b58);
            window.location = "/"
          } catch (err) {
            alert("import failed")
          }
          return false;
        }

        /*
        0 welcome
        1 email/pkey
        2 email auth
        3 pkey gen/import
        4 pkey gen
        5 pkey import
        6 congradulation
        */

        return html`
        <div class="wrapper-inline">
          <main class="no-header wizard-page">
            <div class="wizard">
              <div class="wizard-item">
                <div class="wizard-content">
                  <div class="form-divider"></div>
                  <img src="${BNDLR_HACK}img/content/onboard1.png" alt="" width="220" />
                  <div class="form-mini-divider"></div>
                  <h3 class="onboard">Let‚Äôs get started</h3>
                  <p>We offer self-custody or email based authentication.</p>
                  <div>
                    <a href="/initialize_wallet" class="more-btn" onClick=${e=> fn_move_slider(e, 1)}>
                      Create GPUX Account
                    </a>
                  </div>
                </div>
              </div>
              <div class="wizard-item">
                <div class="wizard-content">
                  <div class="form-divider"></div>
                  <img src="${BNDLR_HACK}img/content/onboard2.png" alt="" width="220" />
                  <div class="form-mini-divider"></div>
                  <h3>Almost There</h3>
                  <p>Choose your method of custody.</p>
                  <div><a href="/" class="more-btn" onClick=${e=> fn_move_slider(e, 2)}>‚úâÔ∏è Continue using Email</a></div>
                  <div>
                    <a href="/private_key" class="more-btn" onClick=${e=> fn_move_slider(e, 3)}>
                      üîê Continue using Private Key
                    </a>
                  </div>
                </div>
              </div>
              <div class="wizard-item">
                <div class="wizard-content">
                  <div class="form-divider"></div>
                  <img src="${BNDLR_HACK}img/content/onboard3.png" alt="" width="220" />
                  <div class="form-mini-divider"></div>
                  <h3>Email Authentication</h3>
                  <p>No need to register just login and your account will be created.</p>
                  <div>
                    <a class="more-btn" style=${{padding: "0px", border: "0px", minWidth: "300px"}}>
                      <div class="form-row-group with-icons">
                        <div class="form-row no-padding" style=${{display: "-webkit-box"}}>
                          <i class="fa fa-envelope"></i>
                          <input type="email" class="form-element" placeholder="" onBlur=${e=> setGlobalState({wizard_new_user: {email: e.target.value}})} />
                        </div>
                      </div>
                    </a>
                  </div>
                  <div>
                    <a class="more-btn" style=${{padding: "0px", border: "0px", minWidth: "300px"}}>
                      <div class="form-row-group with-icons">
                        <div class="form-row no-padding" style=${{display: "-webkit-box"}}>
                          <i class="fa fa-lock"></i>
                          <input type="password" class="form-element" placeholder="" onBlur=${e=> setGlobalState({wizard_new_user: {password: e.target.value}})} />
                        </div>
                      </div>
                    </a>
                  </div>
                  <div><a href="/login_with_email" class="more-btn" onClick=${e=> fn_login_with_email(e)}>Continue</a></div>
                </div>
              </div>
              <div class="wizard-item">
                <div class="wizard-content">
                  <div class="form-divider"></div>
                  <img src="${BNDLR_HACK}img/content/onboard3.png" alt="" width="220" />
                  <div class="form-mini-divider"></div>
                  <h3>Setup Private Key</h3>
                  <P>Generate or import ED25519 private key.</p>
                  <div><a href="/generate_private_key" class="more-btn" onClick=${e=> fn_generate_pkey(e)}>üé≤ Generate Private Key</a></div>
                  <div>
                    <a href="/import_private_key" class="more-btn" onClick=${e=> fn_move_slider(e, 4)}>
                      Import Private Key
                    </a>
                  </div>
                </div>
              </div>
              <div class="wizard-item">
                <div class="wizard-content">
                  <div class="form-divider"></div>
                  <img src="${BNDLR_HACK}img/content/onboard3.png" alt="" width="220" />
                  <div class="form-mini-divider"></div>
                  <h3>Import Private Key</h3>
                  <P>Paste your ED25519 private key in base58 or base64.</p>
                  <div>
                    <a class="more-btn" style=${{padding: "0px", border: "0px", minWidth: "300px"}}>
                      <div class="form-row no-padding">
                        <input type="text" class="form-element" placeholder="sfTh8uY4...X3ppy1m" onBlur=${e=> setGlobalState({wizard_new_user: {secret_key: e.target.value}})} />
                      </div>
                    </a>
                  </div>
                  <div><a href="/import_private_key" class="more-btn" onClick=${e=> fn_login_with_seckey(e)}>Confirm</a></div>
                </div>
              </div>
              <div class="wizard-item">
                <div class="wizard-content">
                  <div class="form-divider"></div>
                  <img src="${BNDLR_HACK}img/content/onboard3.png" alt="" width="220" />
                  <div class="form-mini-divider"></div>
                  <h3>Congratulations!</h3>
                  <P>Check the docs on your way in.</p>
                  <div><a href="/to_wallet" class="more-btn" onClick=${e=> fn_slider_to_wallet(e)}>
                    Take me to my Wallet</a>
                  </div>
                </div>
              </div>
            </div>
            ${
              globalState.wizard_new_user.slider_state.length == 1 ?
                html`<a class="wizard-skip-link" href="https://gpux.ai/">BACK TO GPUX</a>` :
                html`<a class="wizard-skip-link" href="/" onClick=${e=> fn_move_back(e)}>BACK</a>`
            }
          </main>
        </div>
        `
      }

      function Index() {
        const [s, hook_setGlobalState0] = useState(buildInitialState());
        wireUpGlobalState(s, hook_setGlobalState0);

        return html`
        <div class="wrapper">
          <${MenuSide} />
          ${!globalState.pub_b58
            ? html`<${WizardNewUser} />` 
            : html`<${WalletDashboard2} />`
          }
        </div>
        `;
      }

      const MAP = "123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";
      function to_b58(term) {return (typeof term === 'string' || term instanceof String) ? to_b58_1(new TextEncoder().encode(term)) : to_b58_1(term)}
      function to_b58_1(B,A){if(!A){A=MAP};var d=[],s="",i,j,c,n;for(i in B){j=0,c=B[i];s+=c||s.length^i?"":1;while(j in d||c){n=d[j];n=n?n*256+c:c;c=n/58|0;d[j]=n%58;j++}}while(j--)s+=A[d[j]];return s};
      function from_b58(term) {return from_b58_1(term)}
      function from_b58_1(S,A){if(!A){A=MAP};var d=[],b=[],i,j,c,n;for(i in S){j=0,c=A.indexOf(S[i]);if(c<0)return undefined;c||b.length^i?i:b.push(0);while(j in d||c){n=d[j];n=n?n*58+c:c;c=n>>8;d[j]=n%256;j++}}while(j--)b.push(d[j]);return new Uint8Array(b)};

      function generate_random_keypair() {
        var sign_keypair = nacl.sign.keyPair();
        const pub_b58 = to_b58(sign_keypair.publicKey)
        const sec_b58 = to_b58(sign_keypair.secretKey.slice(0,32))
        return [pub_b58, sec_b58]
      }

      function secretkey_to_keypair(seckey) {
        var keyPair_ed = nacl.sign.keyPair.fromSeed(from_b58(seckey))
        var pub_b58 = to_b58(keyPair_ed.publicKey)
        var sec_b58 = to_b58(keyPair_ed.secretKey.slice(0,32))
        return [pub_b58, sec_b58]
      }

      function read_keypair() {
        var guest_seckey = localStorage.getItem("privkey:0");
        if (!guest_seckey) {
          return [null, null];
        } else {
          var seckey = localStorage.getItem("privkey:0");
          return secretkey_to_keypair(seckey)
        }
      }

      function init_seckey(force_refresh) {
        var [pub_b58, sec_b58] = read_keypair()
        if (!pub_b58 || force_refresh) {
          var [pub_b58, sec_b58] = generate_random_keypair();
          localStorage.setItem("privkey:0", sec_b58);
          return [pub_b58, sec_b58]
        } else {
          return [pub_b58, sec_b58]
        }
      }

      async function load() {
        var [pub_b58, sec_b58] = read_keypair()
        if (pub_b58) {
          setInitialState({pub_b58: pub_b58, sec_b58: sec_b58});
        }
        ReactDOM.render(html`<${Index}/>`, document.getElementById("app"));
      }
      load();

    </script>
  </body>
</html>
